{"ast":null,"code":"var _jsxFileName = \"/Volumes/Data/BlockchainCourse/FrontEnd/ethcoupon-finalproject-react/src/RedeemTable.js\";\nimport React, { Component } from 'react';\nimport logo from \"./logo.svg\";\nimport './App.css';\nimport Web3 from 'web3';\nimport { ADDRESS, ABI } from './ABI';\nimport { hello, getPromotion, getRedeemCouponInfo, getCouponWithBalance } from './helper';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nclass RedeemTable extends React.Component {\n  componentDidMount() {\n    this.loadBlockchainData();\n    this.toStoreCouponAmt = this.toStoreCouponAmt.bind(this);\n    this.toStoreWalletAmt = this.toStoreWalletAmt.bind(this);\n  }\n\n  toStoreCouponAmt(event) {\n    this.setState({\n      couponAmt: event.target.value\n    });\n    console.log(event.target.value);\n  }\n\n  toStoreWalletAmt(event) {\n    this.setState({\n      walletAmt: event.target.value\n    });\n    console.log(event.target.value);\n  }\n\n  async loadBlockchainData() {\n    const web3 = new Web3(Web3.givenProvider);\n    const chainId = await web3.eth.getChainId();\n    console.log(chainId);\n    this.setState({\n      accountInfo: ''\n    });\n    var contractInstance = new web3.eth.Contract(ABI, ADDRESS);\n    const accounts = await web3.eth.getAccounts(); // await GetAllPromoCodes(contractInstance);\n\n    var that = this;\n    var codeArray = [];\n    var promoOrigin = [];\n    var promo = [];\n    var promoDate = [];\n    var PromotionLimit = [];\n    promo = await getCouponWithBalance(contractInstance, accounts[0]);\n    console.log(\"Promo data is \");\n    console.log(promo);\n    this.setState({\n      testData: promo\n    });\n    console.log(\"from Home\");\n    console.log(this.state.testData);\n  }\n\n  async PerformTransaction() {\n    const web3 = new Web3(Web3.givenProvider);\n    const accounts = await web3.eth.getAccounts();\n    var contractInstance = new web3.eth.Contract(ABI, ADDRESS);\n    var couponAmt = web3.utils.toWei(this.state.couponAmt.toString(), 'ether');\n    var walletAmt = web3.utils.toWei(this.state.walletAmt.toString(), 'ether');\n    contractInstance.methods.transaction(this.state.promoCode, couponAmt).send({\n      from: accounts[0],\n      value: walletAmt\n    }).on(\"transactionHash\", function (hash) {\n      alert('Transaction success'); // $('#myModal').modal('hide');\n\n      window.location.reload(true);\n    }).on(\"error\", function (error) {\n      alert(error);\n    });\n  }\n\n  open() {\n    this.setState({\n      showModal: true\n    });\n  }\n\n  close() {\n    this.setState({\n      showModal: false\n    });\n  }\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      testData: '',\n      couponAmt: '',\n      walletAmt: ''\n    };\n    this.open = this.open.bind(this);\n    this.close = this.close.bind(this); // console.log(\"list data is \" + JSON.stringify(this.props.testData));\n  }\n\n  render() {\n    const tableHeader = this.props.header;\n    var listData = this.state.testData;\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"table\", {\n        class: \"table table-striped\",\n        children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n          children: /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: tableHeader.map(header => /*#__PURE__*/_jsxDEV(\"th\", {\n              children: header\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 96,\n              columnNumber: 46\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 95,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 94,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n          children: (() => {\n            const rows = [];\n\n            for (let i = 0; i < listData.length; i++) {\n              rows.push( /*#__PURE__*/_jsxDEV(\"tr\", {\n                children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                  children: /*#__PURE__*/_jsxDEV(\"button\", {\n                    type: \"button\",\n                    class: \"btn\",\n                    title: \"Spend coupon value\",\n                    value: listData[i].couponCode,\n                    onClick: this.modalTransaction,\n                    children: /*#__PURE__*/_jsxDEV(\"i\", {\n                      class: \"fa fa-credit-card\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 104,\n                      columnNumber: 153\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 104,\n                    columnNumber: 29\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 104,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  children: listData[i].couponCode\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 105,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  children: new Date(listData[i].date * 1000).toLocaleString()\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 106,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  children: listData[i].targetAddress\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 107,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  children: new Date(listData[i].startDate * 1000).toLocaleString()\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 109,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  children: new Date(listData[i].endDate * 1000).toLocaleString()\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 110,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  children: Web3.utils.fromWei(Web3.utils.toBN(listData[i].amtPerAddress), \"ether\")\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 111,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  children: Web3.utils.fromWei(Web3.utils.toBN(listData[i].Balance), \"ether\")\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 112,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  children: Web3.utils.fromWei(Web3.utils.toBN(listData[i].minRedeemAmt), \"ether\")\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 113,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  children: Web3.utils.fromWei(Web3.utils.toBN(listData[i].maxRedeemAmt), \"ether\")\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 114,\n                  columnNumber: 25\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 103,\n                columnNumber: 31\n              }, this));\n            }\n\n            return rows;\n          })()\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(Modal, {\n        className: \"modalTransaction\",\n        show: this.state.showModal,\n        onHide: this.close,\n        animation: true,\n        bsSize: \"small\",\n        children: [/*#__PURE__*/_jsxDEV(Modal.Header, {\n          closeButton: true,\n          children: /*#__PURE__*/_jsxDEV(Modal.Title, {\n            children: \"Spend coupon value\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 131,\n            columnNumber: 7\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Modal.Body, {\n          children: /*#__PURE__*/_jsxDEV(\"table\", {\n            children: [/*#__PURE__*/_jsxDEV(\"tr\", {\n              style: {\n                height: '45px'\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                style: {\n                  width: '200px'\n                },\n                children: \"Promotion code:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 137,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"text\",\n                  class: \"form-control\",\n                  name: \"txtPromoCode\",\n                  value: this.state.promoCode,\n                  onChange: this.toStorePromoCode,\n                  disabled: true\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 138,\n                  columnNumber: 27\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 138,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 136,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"tr\", {\n              style: {\n                height: '45px'\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                children: \"Coupon amount(eth):\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 141,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"text\",\n                  class: \"form-control\",\n                  name: \"txtAmt\",\n                  value: this.state.CouponAmt,\n                  onChange: this.toStoreCouponAmt\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 142,\n                  columnNumber: 27\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 142,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 140,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"tr\", {\n              style: {\n                height: '45px'\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                children: \"Wallet amount(eth):\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 145,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"text\",\n                  class: \"form-control\",\n                  name: \"txtAmt\",\n                  value: this.state.WalletAmt,\n                  onChange: this.toStoreWalletAmt\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 146,\n                  columnNumber: 27\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 146,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 144,\n              columnNumber: 21\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 135,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Modal.Footer, {\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            class: \"btn btn-success\",\n            onClick: this.PerformTransaction,\n            id: \"btn_transaction\",\n            children: \"Perform Transaction\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 151,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            class: \"btn btn-danger\",\n            onClick: this.close,\n            children: \"Close\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 152,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 150,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true);\n  }\n\n}\n\nexport default RedeemTable;","map":{"version":3,"sources":["/Volumes/Data/BlockchainCourse/FrontEnd/ethcoupon-finalproject-react/src/RedeemTable.js"],"names":["React","Component","Web3","ADDRESS","ABI","hello","getPromotion","getRedeemCouponInfo","getCouponWithBalance","RedeemTable","componentDidMount","loadBlockchainData","toStoreCouponAmt","bind","toStoreWalletAmt","event","setState","couponAmt","target","value","console","log","walletAmt","web3","givenProvider","chainId","eth","getChainId","accountInfo","contractInstance","Contract","accounts","getAccounts","that","codeArray","promoOrigin","promo","promoDate","PromotionLimit","testData","state","PerformTransaction","utils","toWei","toString","methods","transaction","promoCode","send","from","on","hash","alert","window","location","reload","error","open","showModal","close","constructor","props","render","tableHeader","header","listData","map","rows","i","length","push","couponCode","modalTransaction","Date","date","toLocaleString","targetAddress","startDate","endDate","fromWei","toBN","amtPerAddress","Balance","minRedeemAmt","maxRedeemAmt","height","width","toStorePromoCode","CouponAmt","WalletAmt"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport logo from './logo.svg'\nimport './App.css'\nimport Web3 from 'web3'\nimport {ADDRESS, ABI} from './ABI'\nimport {hello,getPromotion,getRedeemCouponInfo,getCouponWithBalance} from './helper';\n\nclass RedeemTable extends React.Component  {\n\n    componentDidMount() {\n        this.loadBlockchainData();\n        this.toStoreCouponAmt = this.toStoreCouponAmt.bind(this);\n        this.toStoreWalletAmt = this.toStoreWalletAmt.bind(this);\n      }\n\n      toStoreCouponAmt(event){\n        this.setState({couponAmt: event.target.value});\n        console.log(event.target.value);\n      }\n\n      toStoreWalletAmt(event){\n        this.setState({walletAmt: event.target.value});\n        console.log(event.target.value);\n      }\n\n      async loadBlockchainData() {\n        const web3 = new Web3(Web3.givenProvider);\n        const chainId = await web3.eth.getChainId();\n        console.log(chainId);\n        this.setState({accountInfo: ''});\n        var contractInstance = new web3.eth.Contract(ABI, ADDRESS);\n        const accounts = await web3.eth.getAccounts();\n        // await GetAllPromoCodes(contractInstance);\n    \n        var that = this;\n        var codeArray = [];\n        var promoOrigin = [];\n        var promo = [];\n        var promoDate = [];\n        var PromotionLimit = [];\n    \n        promo = await getCouponWithBalance(contractInstance,accounts[0]);\n        console.log(\"Promo data is \");\n        console.log(promo);\n        this.setState({testData:promo});\n        console.log(\"from Home\");\n        console.log(this.state.testData);\n    \n      }\n\n    async PerformTransaction(){\n      const web3 = new Web3(Web3.givenProvider);\n      const accounts = await web3.eth.getAccounts();\n      var contractInstance = new web3.eth.Contract(ABI, ADDRESS);\n\n      var couponAmt = web3.utils.toWei(this.state.couponAmt.toString(),'ether');\n      var walletAmt = web3.utils.toWei(this.state.walletAmt.toString(),'ether');\n\n      contractInstance.methods.transaction(this.state.promoCode,couponAmt).send({from: accounts[0],value: walletAmt})\n      .on(\"transactionHash\",function(hash){\n          alert('Transaction success');\n          // $('#myModal').modal('hide');\n          window.location.reload(true);\n      })\n      .on(\"error\", function(error){\n          alert(error);\n      });\n    }\n\n    open() {\n      this.setState({showModal: true});\n    }\n    \n    close() {\n      this.setState({showModal: false});\n    }\n\n    constructor(props) {\n        super(props);\n        this.state = {testData: '',couponAmt:'',walletAmt:''};\n        this.open = this.open.bind(this);\n        this.close = this.close.bind(this);\n        // console.log(\"list data is \" + JSON.stringify(this.props.testData));\n      }\n\n\n\n    render(){\n        const tableHeader = this.props.header;\n        var listData = this.state.testData;\n        return (\n            <>\n            <table class=\"table table-striped\">\n              <thead>\n                <tr>\n                {tableHeader.map((header) => <th>{header}</th>)}\n                </tr>\n              </thead>\n              <tbody>\n                {(() => {\n                    const rows = [];\n                    for (let i = 0; i < listData.length; i++) {\n                    rows.push(<tr>\n                        <td><button type=\"button\" class=\"btn\" title=\"Spend coupon value\" value={listData[i].couponCode} onClick={this.modalTransaction}><i class=\"fa fa-credit-card\"></i></button></td>\n                        <td>{listData[i].couponCode}</td>\n                        <td>{new Date(listData[i].date * 1000).toLocaleString()}</td>\n                        <td>{listData[i].targetAddress}</td>\n                        {/* <td>{Web3.utils.fromWei(Web3.utils.toBN(listData[i].totalEth),\"ether\")}</td> */}\n                        <td>{new Date(listData[i].startDate*1000).toLocaleString()}</td>\n                        <td>{new Date(listData[i].endDate*1000).toLocaleString()}</td>\n                        <td>{Web3.utils.fromWei(Web3.utils.toBN(listData[i].amtPerAddress),\"ether\")}</td>\n                        <td>{Web3.utils.fromWei(Web3.utils.toBN(listData[i].Balance),\"ether\")}</td>\n                        <td>{Web3.utils.fromWei(Web3.utils.toBN(listData[i].minRedeemAmt),\"ether\")}</td>\n                        <td>{Web3.utils.fromWei(Web3.utils.toBN(listData[i].maxRedeemAmt),\"ether\")}</td>\n                        </tr>);\n                    }\n                    return rows;\n                })()\n                }\n              </tbody>\n            </table>\n            {/* {JSON.stringify(listData)} */}\n\n            <Modal className=\"modalTransaction\" \n          show={this.state.showModal} \n          onHide={this.close}\n          animation={true} \n      bsSize=\"small\">\n\n            <Modal.Header closeButton>\n      <Modal.Title>Spend coupon value</Modal.Title>\n          </Modal.Header>\n\n          <Modal.Body>\n          <table>\n                    <tr style={{ height: '45px' }}>\n                      <td style={{ width: '200px' }}>Promotion code:</td>\n                      <td><input type=\"text\" class=\"form-control\" name=\"txtPromoCode\" value={this.state.promoCode} onChange={this.toStorePromoCode} disabled/></td>\n                    </tr>\n                    <tr style={{ height: '45px' }}>\n                      <td>Coupon amount(eth):</td>\n                      <td><input type=\"text\" class=\"form-control\" name=\"txtAmt\" value={this.state.CouponAmt} onChange={this.toStoreCouponAmt} /></td>\n                    </tr>\n                    <tr style={{ height: '45px' }}>\n                      <td>Wallet amount(eth):</td>\n                      <td><input type=\"text\" class=\"form-control\" name=\"txtAmt\" value={this.state.WalletAmt} onChange={this.toStoreWalletAmt} /></td>\n                    </tr>\n                  </table>\n          </Modal.Body>\n          <Modal.Footer>\n            <button type=\"button\" class=\"btn btn-success\" onClick={this.PerformTransaction} id=\"btn_transaction\">Perform Transaction</button>\n            <button type=\"button\" class=\"btn btn-danger\" onClick={this.close}>Close</button>\n          </Modal.Footer>         \n        </Modal> \n\n          </>\n        );\n    }\n}\n\nexport default RedeemTable;"]},"metadata":{},"sourceType":"module"}