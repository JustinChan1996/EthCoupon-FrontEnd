{"ast":null,"code":"var _jsxFileName = \"/Volumes/Data/BlockchainCourse/FrontEnd/ethcoupon-finalproject-react/src/table.js\";\nimport React, { Component } from 'react';\nimport logo from \"./logo.svg\";\nimport './App.css';\nimport Web3 from 'web3';\nimport { ADDRESS, ABI } from './ABI';\nimport { Modal, Button } from \"react-bootstrap\";\nimport { hello, getPromotion, getPromotionWithBalances } from './helper';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nclass Table1 extends React.Component {\n  componentDidMount() {\n    this.loadBlockchainData();\n    this.TopUpFunds = this.TopUpFunds.bind(this);\n    this.reclaimEthers = this.reclaimEthers.bind(this);\n    this.showTopUpModal = this.showTopUpModal.bind(this);\n    this.toStoreAmount = this.toStoreAmount.bind(this);\n  }\n\n  toStoreAmount(event) {\n    this.setState({\n      amount: event.target.value\n    });\n    console.log(event.target.value);\n  }\n\n  showTopUpModal(e) {\n    // event.preventDefault();\n    // alert(\"hello \" + event.target.value);\n    e.preventDefault();\n    var promoCodeValue = e.currentTarget.value;\n    this.setState({\n      promoCode: promoCodeValue\n    });\n    this.open(); //console.log(e.currentTarget.value);\n  }\n\n  async loadBlockchainData() {\n    const web3 = new Web3(Web3.givenProvider);\n    const chainId = await web3.eth.getChainId();\n    console.log(chainId);\n    this.setState({\n      accountInfo: ''\n    });\n    var contractInstance = new web3.eth.Contract(ABI, ADDRESS);\n    const accounts = await web3.eth.getAccounts(); // await GetAllPromoCodes(contractInstance);\n\n    var that = this;\n    var codeArray = [];\n    var promoOrigin = [];\n    var promo = [];\n    var promoDate = [];\n    var PromotionLimit = [];\n    promo = await getPromotionWithBalances(contractInstance, accounts[0]);\n    console.log(promo);\n    this.setState({\n      testData: promo\n    });\n    console.log(\"from Home\");\n    console.log(this.state.testData);\n  }\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      testData: '',\n      promoCode: ''\n    };\n    this.open = this.open.bind(this);\n    this.close = this.close.bind(this); // console.log(\"list data is \" + JSON.stringify(this.props.testData));\n  }\n\n  open() {\n    this.setState({\n      showModal: true\n    });\n  }\n\n  close() {\n    this.setState({\n      showModal: false\n    });\n  }\n\n  async TopUpFunds() {\n    const web3 = new Web3(Web3.givenProvider);\n    const accounts = await web3.eth.getAccounts();\n    var contractInstance = new web3.eth.Contract(ABI, ADDRESS);\n    var weiValue = web3.utils.toWei(this.state.amount.toString(), 'ether');\n    var that = this;\n    contractInstance.methods.topUp(this.state.promoCode).send({\n      from: accounts[0],\n      value: weiValue\n    }).on(\"receipt\", function (hash) {\n      alert('Promotion top up success');\n      that.close();\n      window.location.reload(true);\n    }).on(\"error\", function (error) {\n      alert(error);\n    });\n  }\n\n  async reclaimEthers(e) {\n    e.preventDefault();\n    var promoCode = e.currentTarget.value;\n    const web3 = new Web3(Web3.givenProvider);\n    const accounts = await web3.eth.getAccounts();\n    var contractInstance = new web3.eth.Contract(ABI, ADDRESS); // var weiValue = web3.utils.toWei(this.state.amount.toString(),'ether');\n\n    var that = this;\n    contractInstance.methods.collectLeftoverEther(promoCode).send({\n      from: accounts[0]\n    }).on(\"receipt\", function (receipt) {\n      console.log(receipt);\n      alert(web3.utils.fromWei(receipt.events.CollectLeftOver.returnValues.amount, \"ether\") + ' unspent remaining Ether reclaimed by user');\n      that.close();\n      window.location.reload(true);\n    }).on(\"error\", function (error) {\n      console.log(error);\n      alert(error);\n    });\n  }\n\n  render() {\n    const tableHeader = this.props.header;\n    var listData = this.state.testData;\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"table\", {\n        class: \"table table-striped\",\n        children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n          children: /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: tableHeader.map(header => /*#__PURE__*/_jsxDEV(\"th\", {\n              children: header\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 129,\n              columnNumber: 46\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 128,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 127,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n          children: (() => {\n            {\n              console.log(\"List data is \");\n            }\n            {\n              console.log(listData);\n            }\n            const rows = [];\n\n            for (let i = 0; i < listData.length; i++) {\n              // For promotions sponsored, only show active and expired promotions if unclaimed\n              if (!(new Date() > new Date(listData[i].endDate * 1000) && Web3.utils.fromWei(Web3.utils.toBN(listData[i].totalEth), \"ether\") == 0)) {\n                rows.push( /*#__PURE__*/_jsxDEV(\"tr\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                    children: [\" \", (() => {\n                      if (new Date() > new Date(listData[i].endDate * 1000)) {\n                        return /*#__PURE__*/_jsxDEV(_Fragment, {\n                          children: /*#__PURE__*/_jsxDEV(\"button\", {\n                            type: \"button\",\n                            class: \"btn\",\n                            title: \"Reclaim unspent Ethers\",\n                            value: listData[i].couponCode,\n                            onClick: this.reclaimEthers,\n                            children: /*#__PURE__*/_jsxDEV(\"i\", {\n                              class: \"fa fa-times\"\n                            }, void 0, false, {\n                              fileName: _jsxFileName,\n                              lineNumber: 143,\n                              columnNumber: 163\n                            }, this)\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 143,\n                            columnNumber: 38\n                          }, this)\n                        }, void 0, false);\n                      } else {\n                        return /*#__PURE__*/_jsxDEV(_Fragment, {\n                          children: /*#__PURE__*/_jsxDEV(\"button\", {\n                            type: \"button\",\n                            class: \"btn\",\n                            title: \"Top up promotion\",\n                            value: listData[i].couponCode,\n                            onClick: this.showTopUpModal,\n                            children: /*#__PURE__*/_jsxDEV(\"i\", {\n                              class: \"fa fa-credit-card\"\n                            }, void 0, false, {\n                              fileName: _jsxFileName,\n                              lineNumber: 146,\n                              columnNumber: 158\n                            }, this)\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 146,\n                            columnNumber: 38\n                          }, this)\n                        }, void 0, false);\n                      }\n                    })()]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 141,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                    children: listData[i].couponCode\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 150,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                    children: new Date(listData[i].dateCreated * 1000).toLocaleString()\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 151,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                    children: listData[i].targetAddress\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 152,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                    children: Web3.utils.fromWei(Web3.utils.toBN(listData[i].totalEth), \"ether\")\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 153,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                    children: Web3.utils.fromWei(Web3.utils.toBN(listData[i].Balance), \"ether\")\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 155,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                    children: new Date(listData[i].startDate * 1000).toLocaleString()\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 156,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                    children: new Date(listData[i].endDate * 1000).toLocaleString()\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 157,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                    children: Web3.utils.fromWei(Web3.utils.toBN(listData[i].amtPerAddress), \"ether\")\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 158,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                    children: Web3.utils.fromWei(Web3.utils.toBN(listData[i].minRedeemAmt), \"ether\")\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 159,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                    children: Web3.utils.fromWei(Web3.utils.toBN(listData[i].maxRedeemAmt), \"ether\")\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 160,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 140,\n                  columnNumber: 33\n                }, this));\n              }\n            }\n\n            return rows;\n          })()\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(Modal, {\n        className: \"modalTopUp\",\n        show: this.state.showModal,\n        onHide: this.close,\n        animation: true,\n        bsSize: \"small\",\n        children: [/*#__PURE__*/_jsxDEV(Modal.Header, {\n          closeButton: true,\n          children: /*#__PURE__*/_jsxDEV(Modal.Title, {\n            children: \"Top Up Promotion Funds\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 178,\n            columnNumber: 7\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 23\n        }, this), /*#__PURE__*/_jsxDEV(Modal.Body, {\n          children: /*#__PURE__*/_jsxDEV(\"table\", {\n            children: [/*#__PURE__*/_jsxDEV(\"tr\", {\n              style: {\n                height: '45px'\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                style: {\n                  width: '200px'\n                },\n                children: \"Promotion code:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 184,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"text\",\n                  class: \"form-control\",\n                  name: \"txtPromoCode\",\n                  value: this.state.promoCode,\n                  onChange: this.toStorePromoCode,\n                  disabled: true\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 185,\n                  columnNumber: 27\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 185,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 183,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"tr\", {\n              style: {\n                height: '45px'\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                children: \"Amount top up(eth):\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 188,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"text\",\n                  class: \"form-control\",\n                  name: \"txtAmt\",\n                  value: this.state.amount,\n                  onChange: this.toStoreAmount\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 189,\n                  columnNumber: 27\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 189,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 187,\n              columnNumber: 21\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 182,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 181,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Modal.Footer, {\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            class: \"btn btn-success\",\n            onClick: this.TopUpFunds,\n            id: \"btn_TopUp\",\n            children: \"Top Up Promotion Funds\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 195,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            class: \"btn btn-danger\",\n            onClick: this.close,\n            children: \"Close\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 196,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true);\n  }\n\n}\n\nexport default Table1;","map":{"version":3,"sources":["/Volumes/Data/BlockchainCourse/FrontEnd/ethcoupon-finalproject-react/src/table.js"],"names":["React","Component","Web3","ADDRESS","ABI","Modal","Button","hello","getPromotion","getPromotionWithBalances","Table1","componentDidMount","loadBlockchainData","TopUpFunds","bind","reclaimEthers","showTopUpModal","toStoreAmount","event","setState","amount","target","value","console","log","e","preventDefault","promoCodeValue","currentTarget","promoCode","open","web3","givenProvider","chainId","eth","getChainId","accountInfo","contractInstance","Contract","accounts","getAccounts","that","codeArray","promoOrigin","promo","promoDate","PromotionLimit","testData","state","constructor","props","close","showModal","weiValue","utils","toWei","toString","methods","topUp","send","from","on","hash","alert","window","location","reload","error","collectLeftoverEther","receipt","fromWei","events","CollectLeftOver","returnValues","render","tableHeader","header","listData","map","rows","i","length","Date","endDate","toBN","totalEth","push","couponCode","dateCreated","toLocaleString","targetAddress","Balance","startDate","amtPerAddress","minRedeemAmt","maxRedeemAmt","height","width","toStorePromoCode"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport logo from './logo.svg'\nimport './App.css'\nimport Web3 from 'web3'\nimport {ADDRESS, ABI} from './ABI'\nimport { Modal, Button } from \"react-bootstrap\";\nimport {hello,getPromotion,getPromotionWithBalances} from './helper';\n\nclass Table1 extends React.Component  {\n\n    componentDidMount() {\n        this.loadBlockchainData();\n        this.TopUpFunds = this.TopUpFunds.bind(this);\n        this.reclaimEthers = this.reclaimEthers.bind(this);\n        this.showTopUpModal = this.showTopUpModal.bind(this);\n        this.toStoreAmount = this.toStoreAmount.bind(this);\n      }\n\n      toStoreAmount(event){\n        this.setState({amount: event.target.value});\n        console.log(event.target.value);\n      }\n\n      showTopUpModal(e){\n        // event.preventDefault();\n        // alert(\"hello \" + event.target.value);\n        e.preventDefault();\n        var promoCodeValue = e.currentTarget.value;\n        this.setState({promoCode: promoCodeValue});\n        this.open();\n        //console.log(e.currentTarget.value);\n        \n      }\n\n      async loadBlockchainData() {\n        const web3 = new Web3(Web3.givenProvider);\n        const chainId = await web3.eth.getChainId();\n        console.log(chainId);\n        this.setState({accountInfo: ''});\n        var contractInstance = new web3.eth.Contract(ABI, ADDRESS);\n        const accounts = await web3.eth.getAccounts();\n        // await GetAllPromoCodes(contractInstance);\n    \n        var that = this;\n        var codeArray = [];\n        var promoOrigin = [];\n        var promo = [];\n        var promoDate = [];\n        var PromotionLimit = [];\n    \n        promo = await getPromotionWithBalances(contractInstance,accounts[0]);\n        console.log(promo);\n        this.setState({testData:promo});\n        console.log(\"from Home\");\n        console.log(this.state.testData);\n    \n      }\n\n    constructor(props) {\n        super(props);\n        this.state = {testData: '',promoCode: ''};\n        this.open = this.open.bind(this);\n        this.close = this.close.bind(this);\n        // console.log(\"list data is \" + JSON.stringify(this.props.testData));\n      }\n\n      open() {\n        this.setState({showModal: true});\n      }\n      \n      close() {\n        this.setState({showModal: false});\n      }\n\n      async TopUpFunds(){\n        const web3 = new Web3(Web3.givenProvider);\n        const accounts = await web3.eth.getAccounts();\n        var contractInstance = new web3.eth.Contract(ABI, ADDRESS);\n        var weiValue = web3.utils.toWei(this.state.amount.toString(),'ether');\n\n        var that = this;\n\n        contractInstance.methods.topUp(this.state.promoCode).send({from: accounts[0], value: weiValue})\n        .on(\"receipt\",function(hash){\n          alert('Promotion top up success');\n          that.close();\n          window.location.reload(true);\n        })\n        .on(\"error\", function(error){\n          alert(error);\n        });\n\n      }\n\n    async reclaimEthers(e){\n        e.preventDefault();\n        var promoCode = e.currentTarget.value;\n\n        const web3 = new Web3(Web3.givenProvider);\n        const accounts = await web3.eth.getAccounts();\n        var contractInstance = new web3.eth.Contract(ABI, ADDRESS);\n        // var weiValue = web3.utils.toWei(this.state.amount.toString(),'ether');\n\n        var that = this;\n\n\n        contractInstance.methods.collectLeftoverEther(promoCode).send({from: accounts[0]})\n        .on(\"receipt\",function(receipt){\n          console.log(receipt);\n          alert(web3.utils.fromWei(receipt.events.CollectLeftOver.returnValues.amount,\"ether\") + ' unspent remaining Ether reclaimed by user');\n          that.close();\n          window.location.reload(true);\n        })\n        .on(\"error\", function(error){\n          console.log(error);\n          alert(error);\n        });\n      }\n\n\n    render(){\n        const tableHeader = this.props.header;\n        var listData = this.state.testData;\n        return (\n            <>\n            <table class=\"table table-striped\">\n              <thead>\n                <tr>\n                {tableHeader.map((header) => <th>{header}</th>)}\n                </tr>\n              </thead>\n              <tbody>\n                {(() => {\n                  {console.log(\"List data is \")}\n                              {console.log(listData)}\n                    const rows = [];\n                    for (let i = 0; i < listData.length; i++) {\n                    // For promotions sponsored, only show active and expired promotions if unclaimed\n                    if(!(new Date() > new Date(listData[i].endDate * 1000) && (Web3.utils.fromWei(Web3.utils.toBN(listData[i].totalEth),\"ether\") == 0))){\n                      rows.push(<tr>\n                        <td> {(() => {\n                          if(new Date() > new Date(listData[i].endDate * 1000)){\n                            return <><button type=\"button\" class=\"btn\" title=\"Reclaim unspent Ethers\" value={listData[i].couponCode} onClick={this.reclaimEthers}><i class=\"fa fa-times\"></i></button></>\n                          }\n                          else{\n                            return <><button type=\"button\" class=\"btn\" title=\"Top up promotion\" value={listData[i].couponCode} onClick={this.showTopUpModal}><i class=\"fa fa-credit-card\"></i></button></>\n                          }\n                          })()}</td>\n                        {/* <td><button type=\"button\" class=\"btn\" title=\"top up promotion\" value={listData[i].couponCode} onClick={this.showTopUpModal}><i class=\"fa fa-credit-card\"></i></button></td> */}\n                        <td>{listData[i].couponCode}</td>\n                        <td>{new Date(listData[i].dateCreated * 1000).toLocaleString()}</td>\n                        <td>{listData[i].targetAddress}</td>\n                        <td>{Web3.utils.fromWei(Web3.utils.toBN(listData[i].totalEth),\"ether\")}</td>\n                        {/* <td>{listData[i].unspentEther}</td> */}\n                        <td>{Web3.utils.fromWei(Web3.utils.toBN(listData[i].Balance),\"ether\")}</td>\n                        <td>{new Date(listData[i].startDate*1000).toLocaleString()}</td>\n                        <td>{new Date(listData[i].endDate*1000).toLocaleString()}</td>\n                        <td>{Web3.utils.fromWei(Web3.utils.toBN(listData[i].amtPerAddress),\"ether\")}</td>\n                        <td>{Web3.utils.fromWei(Web3.utils.toBN(listData[i].minRedeemAmt),\"ether\")}</td>\n                        <td>{Web3.utils.fromWei(Web3.utils.toBN(listData[i].maxRedeemAmt),\"ether\")}</td>\n                        </tr>);\n                      } \n                    }\n                    return rows;\n                })()\n                }\n              </tbody>\n            </table>\n            {/* {JSON.stringify(listData)} */}\n\n            <Modal className=\"modalTopUp\" \n          show={this.state.showModal} \n          onHide={this.close}\n          animation={true} \n      bsSize=\"small\">\n\n                      <Modal.Header closeButton>\n      <Modal.Title>Top Up Promotion Funds</Modal.Title>\n          </Modal.Header>\n\n          <Modal.Body>\n          <table>\n                    <tr style={{ height: '45px' }}>\n                      <td style={{ width: '200px' }}>Promotion code:</td>\n                      <td><input type=\"text\" class=\"form-control\" name=\"txtPromoCode\" value={this.state.promoCode} onChange={this.toStorePromoCode} disabled/></td>\n                    </tr>\n                    <tr style={{ height: '45px' }}>\n                      <td>Amount top up(eth):</td>\n                      <td><input type=\"text\" class=\"form-control\" name=\"txtAmt\" value={this.state.amount} onChange={this.toStoreAmount} /></td>\n                    </tr>\n                  </table>\n          </Modal.Body>\n\n          <Modal.Footer>\n            <button type=\"button\" class=\"btn btn-success\" onClick={this.TopUpFunds} id=\"btn_TopUp\">Top Up Promotion Funds</button>\n            <button type=\"button\" class=\"btn btn-danger\" onClick={this.close}>Close</button>\n          </Modal.Footer>         \n        </Modal> \n\n          </>\n        );\n    }\n}\n\nexport default Table1;"]},"metadata":{},"sourceType":"module"}