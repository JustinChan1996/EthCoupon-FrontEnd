{"ast":null,"code":"import Web3 from 'web3';\nexport function hello() {\n  alert('hello');\n}\nexport function getPromotion(contractInstance, account) {\n  return new Promise(function (resolve, reject) {\n    var codeArray = [];\n    contractInstance.getPastEvents('Promotion', {\n      filter: {\n        sponsorAddress: account\n      },\n      // Using an array means OR: e.g. 20 or 23\n      fromBlock: 0,\n      toBlock: 'latest'\n    }, function (error, events) {\n      console.log(events);\n\n      if (events.length > 0) {\n        // console.log(events[0].returnValues); \n        for (var i = 0; i < events.length; i++) {\n          console.log(events[i].returnValues);\n          codeArray.push(events[i].returnValues); // codeArray.push([events[i].returnValues.couponCode,events[i].returnValues.sponsorAddress,new Date(events[i].returnValues.dateCreated*1000),events[i].returnValues.targetAddress,Web3.utils.fromWei(events[i].returnValues.totalEth,\"ether\"),Web3.utils.fromWei(events[i].returnValues.amtPerAddress,\"ether\"),Web3.utils.fromWei(events[i].returnValues.minRedeemAmt,\"ether\"),Web3.utils.fromWei(events[i].returnValues.maxRedeemAmt,\"ether\"),new Date(events[i].returnValues.startDate*1000),new Date(events[i].returnValues.endDate*1000)]);\n        }\n\n        resolve(Object.entries(codeArray));\n      }\n    }).then(function (events) {});\n  });\n}\nexport function getPromotionForCouponHash(contractInstance, hash) {\n  return new Promise(function (resolve, reject) {\n    var codeArray = [];\n    contractInstance.getPastEvents('Promotion', {\n      filter: {\n        couponHash: hash\n      },\n      // Using an array means OR: e.g. 20 or 23\n      fromBlock: 0,\n      toBlock: 'latest'\n    }, function (error, events) {\n      console.log(events);\n\n      if (events.length > 0) {\n        // console.log(events[0].returnValues); \n        // for(var i=0;i<events.length;i++){\n        codeArray.push([events[0].returnValues.couponCode, events[0].returnValues.sponsorAddress, new Date(events[0].returnValues.dateCreated * 1000), events[0].returnValues.targetAddress, Web3.utils.fromWei(events[0].returnValues.totalEth, \"ether\"), Web3.utils.fromWei(events[0].returnValues.amtPerAddress, \"ether\"), Web3.utils.fromWei(events[0].returnValues.minRedeemAmt, \"ether\"), Web3.utils.fromWei(events[0].returnValues.maxRedeemAmt, \"ether\"), new Date(events[0].returnValues.startDate * 1000), new Date(events[0].returnValues.endDate * 1000)]); // }\n\n        resolve(codeArray);\n      }\n    }).then(function (events) {});\n  });\n}\nexport function getRedeem(contractInstance, account) {\n  return new Promise(function (resolve, reject) {\n    var codeArray = [];\n    contractInstance.getPastEvents('Redeem', {\n      filter: {\n        user: account\n      },\n      // Using an array means OR: e.g. 20 or 23\n      fromBlock: 0,\n      toBlock: 'latest'\n    }, function (error, events) {\n      console.log(events);\n\n      if (events.length > 0) {\n        // console.log(events[0].returnValues);\n        for (var i = 0; i < events.length; i++) {\n          codeArray.push([events[i].returnValues.couponHash, events[i].returnValues.user, events[i].returnValues.RedeemID, events[i].returnValues.date]);\n        }\n\n        resolve(codeArray);\n      }\n    }).then(function (events) {});\n  });\n}\nexport async function getRedeemCouponInfo(contractInstance, account) {\n  // return new Promise(function(resolve, reject) {\n  var redeems = await getRedeem(contractInstance, account);\n\n  for (var i = 0; i < redeems.length; i++) {\n    var couponInfo = await getPromotionForCouponHash(contractInstance, redeems[i][0]); // append promotion code, starting date, ending date, amount redemmed, min coupon txn amount and max coupon txn amount\n\n    console.log(couponInfo);\n\n    if (couponInfo.length > 0) {\n      // redeems[i] = redeems[i].push(couponInfo[0]).push(couponInfo[8]).push(couponInfo[9]).push(couponInfo[6]).push(couponInfo[7]);\n      redeems[i].push(couponInfo[0][0], couponInfo[0][8], couponInfo[0][9], couponInfo[0][5], couponInfo[0][6], couponInfo[0][7]);\n    }\n  } // output array structure(index notation)\n  // 0) couponHash\n  // 1) user address\n  // 2) RedeemID\n  // 3) date\n  // 4) promotion code\n  // 5) starting date\n  // 6) ending date\n  // 7) amount redemmed\n  // 8) min coupon txn amount\n  // 9) max coupon txn amount\n\n\n  return redeems; //     resolve(redeems); \n  // });\n}","map":{"version":3,"sources":["/Volumes/Data/BlockchainCourse/FrontEnd/ethcoupon-finalproject-react/src/helper.js"],"names":["Web3","hello","alert","getPromotion","contractInstance","account","Promise","resolve","reject","codeArray","getPastEvents","filter","sponsorAddress","fromBlock","toBlock","error","events","console","log","length","i","returnValues","push","Object","entries","then","getPromotionForCouponHash","hash","couponHash","couponCode","Date","dateCreated","targetAddress","utils","fromWei","totalEth","amtPerAddress","minRedeemAmt","maxRedeemAmt","startDate","endDate","getRedeem","user","RedeemID","date","getRedeemCouponInfo","redeems","couponInfo"],"mappings":"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","sourcesContent":["import Web3 from 'web3'\n\nexport function hello(){\n    alert('hello');\n}\n\nexport function getPromotion(contractInstance,account){\n    return new Promise(function(resolve, reject) {\n        var codeArray = [];\n        contractInstance.getPastEvents('Promotion', {\n            filter: {sponsorAddress:account}, // Using an array means OR: e.g. 20 or 23\n            fromBlock: 0,\n            toBlock: 'latest'\n        }, function(error, events){\n          console.log(events);\n          if(events.length > 0){\n            // console.log(events[0].returnValues); \n            for(var i=0;i<events.length;i++){\n              console.log(events[i].returnValues);\n              codeArray.push(events[i].returnValues);\n              // codeArray.push([events[i].returnValues.couponCode,events[i].returnValues.sponsorAddress,new Date(events[i].returnValues.dateCreated*1000),events[i].returnValues.targetAddress,Web3.utils.fromWei(events[i].returnValues.totalEth,\"ether\"),Web3.utils.fromWei(events[i].returnValues.amtPerAddress,\"ether\"),Web3.utils.fromWei(events[i].returnValues.minRedeemAmt,\"ether\"),Web3.utils.fromWei(events[i].returnValues.maxRedeemAmt,\"ether\"),new Date(events[i].returnValues.startDate*1000),new Date(events[i].returnValues.endDate*1000)]);\n            }\n            resolve(Object.entries(codeArray));            \n          }\n          })\n        .then(function(events){\n        });\n    });\n}\n\nexport function getPromotionForCouponHash(contractInstance,hash){\n  return new Promise(function(resolve, reject) {\n      var codeArray = [];\n      contractInstance.getPastEvents('Promotion', {\n          filter: {couponHash:hash}, // Using an array means OR: e.g. 20 or 23\n          fromBlock: 0,\n          toBlock: 'latest'\n      }, function(error, events){\n        console.log(events);\n        if(events.length > 0){\n          // console.log(events[0].returnValues); \n          // for(var i=0;i<events.length;i++){\n            codeArray.push([events[0].returnValues.couponCode,events[0].returnValues.sponsorAddress,new Date(events[0].returnValues.dateCreated*1000),events[0].returnValues.targetAddress,Web3.utils.fromWei(events[0].returnValues.totalEth,\"ether\"),Web3.utils.fromWei(events[0].returnValues.amtPerAddress,\"ether\"),Web3.utils.fromWei(events[0].returnValues.minRedeemAmt,\"ether\"),Web3.utils.fromWei(events[0].returnValues.maxRedeemAmt,\"ether\"),new Date(events[0].returnValues.startDate*1000),new Date(events[0].returnValues.endDate*1000)]);\n          // }\n          resolve(codeArray);            \n        }\n        })\n      .then(function(events){\n      });\n  });\n}\n\n\nexport function getRedeem(contractInstance,account){\n    return new Promise(function(resolve, reject) {\n        var codeArray = [];\n        contractInstance.getPastEvents('Redeem', {\n            filter: {user:account}, // Using an array means OR: e.g. 20 or 23\n            fromBlock: 0,\n            toBlock: 'latest'\n        }, function(error, events){\n          console.log(events);\n          if(events.length > 0){\n            // console.log(events[0].returnValues);\n            for(var i=0;i<events.length;i++){\n              codeArray.push([events[i].returnValues.couponHash,events[i].returnValues.user,events[i].returnValues.RedeemID,events[i].returnValues.date]);\n            } \n            resolve(codeArray);            \n          }\n          })\n        .then(function(events){\n        });\n    });\n}\n\nexport async function getRedeemCouponInfo(contractInstance,account){\n    // return new Promise(function(resolve, reject) {\n\n      var redeems = await getRedeem(contractInstance,account);\n      for(var i=0;i<redeems.length;i++){\n        var couponInfo = await getPromotionForCouponHash(contractInstance,redeems[i][0]);\n        // append promotion code, starting date, ending date, amount redemmed, min coupon txn amount and max coupon txn amount\n        console.log(couponInfo)\n        if(couponInfo.length > 0){\n          // redeems[i] = redeems[i].push(couponInfo[0]).push(couponInfo[8]).push(couponInfo[9]).push(couponInfo[6]).push(couponInfo[7]);\n          redeems[i].push(couponInfo[0][0],couponInfo[0][8],couponInfo[0][9],couponInfo[0][5],couponInfo[0][6],couponInfo[0][7]);\n        }\n      }\n      // output array structure(index notation)\n      // 0) couponHash\n      // 1) user address\n      // 2) RedeemID\n      // 3) date\n      // 4) promotion code\n      // 5) starting date\n      // 6) ending date\n      // 7) amount redemmed\n      // 8) min coupon txn amount\n      // 9) max coupon txn amount\n      return redeems;\n  //     resolve(redeems); \n  // });\n}\n\n"]},"metadata":{},"sourceType":"module"}